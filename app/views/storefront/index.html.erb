
<div style="float: left; width: 400px;">
  <h2>What's going on?</h2>
  <%= render :partial => 'claims/log', :locals => {:claims => @recent_claims} %>
  <%= link_to "full log", :controller => :claims, :action => :log %> 
</div>

<div style="float: left;">
  <h2>Spots</h2>
  <%= GMap.header %>  

  <%
  unless @spots.empty?
    @map.center_zoom_init(@spots[-1].geolocation, 13)  # zoom to last spot

    @spots.each do |spot|
      marker = GMarker.new(spot.geolocation,
        :title => spot.name, :info_window => "<strong>%s</strong><br/>SMS Code: %s<br/>claimed by: %s<br/>%s" % [spot.name, spot.code, spot.current_owner ? spot.current_owner.login : "no one", link_to('claim!', :controller => 'claims', :action => 'spot', :id => spot)])  
        @map.overlay_init(marker)
      
      if spot.current_owner
        #radius around spots
        @map.overlay_init(GPolygon.new(circle_points(spot.geolocation_x, spot.geolocation_y, 0.005), spot.current_owner.colour_1, 0, 0.5, spot.current_owner.colour_1, 0.5))
      end
      
      if params[:focus] and params[:focus] == spot.code
        @map.center_zoom_init(spot.geolocation, 13)  # zoom to last spot
      end
    end
  end
  %>
  <%= @map.div(:width => 600, :height => 400) %>
  <%= @map.to_html %>
</div>